{%  extends 'layout.twig' %}

 {% block content %}

 <div class="container" style="margin-top:-30px;">

     <div class="row mb-3">
         <div class="col-sm-12">
             <div class="card border-0 shadow-sm">
                 <div class="card-body">
                     <div class="d-flex align-items-center">
                        
                         <div class="flex-fill w-100">
                             <h4 class="mb-0">placeHolder</h4>
                             <p class="mb-0 small text-muted">
                                 placeHolder Text
                             </p>
                         </div>
                         <div class="flex-fill text-right" style="min-width:250px;">
                             <a href="{{ url('videos') }}" class="btn btn-default">Videos Home</a>
                         </div>
                     </div>
                 </div>
             </div>
         </div>
     </div>

     <div class="row">
         <div class="col-sm-12 col-lg-12">
             <div class="card border-0 shadow-sm overflow-hidden">
                 {% if errors is defined %}
                     <div class="alert alert-danger rounded-0">
                         <p class="mb-2">Errors were encountered when submitting your video:</p>
                         <ul class="mb-0 pl-3">
                             {% for key, value in errors %}
                             <li>&bull; {{ value }}</li>
                             {% endfor %}
                         </ul>
                     </div>
                 {% endif %}

                 <div class="card-body">
                     <form method="post" action="{{ url('videos/add') }}" id="postform">
                         <div class="form-row form-group">
                             <div class="col-sm-12 col-lg-3">
                                 <label>Channel Name*</label>
                                 <input type="text" class="form-control {{ errors['category'] is defined ? 'border-danger' : '' }}" name="category">

                             </div>
                             <div class="col-sm-12 col-lg-9">
                                 <label>Video Title*</label>
                                 <input type="text" class="form-control {{ errors['title'] is defined ? 'border-danger' : '' }}" name="title">
                             </div>
                         </div>

                         <div class="accordion" id="Extras">
                            <div class="card">
                              <div class="bg-danger card" id="headingOne">
                                <h1 class="mb-0">
                                  <button class="text-white btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    Show advanced options
                                  </button>
                                </h1>
                              </div>
                              <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#Extras">
                                <div class="card-body">
                                 
                                    

                                    <div class="form-row form-group">
                                        <div class="col-sm-12 col-lg-3">
                                            <label>Channel Name*</label>
                                            <input type="text" class="form-control {{ errors['category'] is defined ? 'border-danger' : '' }}" name="category">
           
                                        </div>
                                        <div class="col-sm-12 col-lg-9">
                                            <label>Video Title*</label>
                                            <input type="text" class="form-control {{ errors['title'] is defined ? 'border-danger' : '' }}" name="title">
                                        </div>
                                    </div>





                                </div>
                              </div>
                            </div>

                          </div>


                         <hr>

                         <div class="form-group">
                             <div id="editor" class="mb-3 {{ errors['content'] is defined ? 'border-danger' : '' }}"></div>
                             <textarea name='content' id='editor-form' style='display:none'></textarea>
                         </div>

                         <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

                         <div class="form-group">
                             <button type="submit" class="btn btn-danger shadow-none" id="submit">
                                 Submit Video
                             </button>

                             <div id="toolbar" class="d-inline-block">
                                 <span class="ql-formats">
                                     <button class="ql-bold"
                                         data-toggle="tooltip" data-title="Bold"></button>
                                     <button class="ql-italic"
                                         data-toggle="tooltip" data-title="Italic"></button>
                                     <button class="ql-underline"
                                         data-toggle="tooltip" data-title="Underline"></button>
                                     <button class="ql-strike"
                                         data-toggle="tooltip" data-title="Strikethrough"></button>
                                 </span>

                                 <span class="ql-formats">
                                     <button class="ql-list" value="ordered"
                                         data-toggle="tooltip" data-title="Ordered List"></button>
                                     <button class="ql-list" value="bullet"
                                         data-toggle="tooltip" data-title="Bullet List"></button>
                                 </span>

                                 <span class="ql-formats">
                                     <button class="ql-link"
                                         data-toggle="tooltip" data-title="Link"></button>
                                     <button class="ql-image"
                                         data-toggle="tooltip" data-title="Image"></button>
                                 </span>

                                 <span class="ql-formats">
                                     <button class="ql-clean"  data-toggle="tooltip" data-title="Clear Formatting"></button>
                                 </span>
                             </div>
                         </div>
                     </form>
                 </div>
             </div>
         </div>
     </div>

     {{ content|raw }}
 </div>


 <script>
     document.addEventListener('DOMContentLoaded', function(event) {
         var apiUrl = 'https://api.imgur.com/3/image';
         var apiKey = '{{ constant("imgur_key") }}';
         var quill = new Quill('#editor', {
             theme: 'snow',
             modules: {
                 toolbar: '#toolbar'
             },
             placeholder: 'Paste your YouTube video embed code here'
         });
         let alert = $('.alert-box');
         quill.getModule("toolbar").addHandler("image", function (a) {
             var input = document.createElement('input');
             input.setAttribute('type', 'file');
             input.click();
             input.onchange = (s) => {
                 var file = input.files[0];
                 if (/^image\//.test(file.type)) {
                     var settings = {
                         async: true,
                         crossDomain: true,
                         processData: false,
                         contentType: false,
                         type: 'POST',
                         url: apiUrl,
                         headers: {
                             Authorization: 'Client-ID ' + apiKey,
                             Accept: 'application/json'
                         },
                         mimeType: 'multipart/form-data'
                     };
                     var formData = new FormData();
                     formData.append("image", file);
                     settings.data = formData;
                     quill.enable(false);
                     var range = quill.getSelection();
                     if (range) {
                         $.ajax(settings).done(function(response) {
                             var json = JSON.parse(response);
                             var index = range.index;
                             quill.insertEmbed(index, 'image', json.data.link);
                             quill.enable();
                         });
                     } else {
                         alert("Please select a spot in your post where you wish the image to be placed.")
                     }
                 } else {
                     console.warn('You can only upload images.');
                 }
             }
         });

         $("#postform").on("submit", function (event) {
             var body = $(this).find(".ql-editor").html();
             $(this).find("#editor-form").html(body);
             return true;
         });
     });
     </script>

 {%  endblock %}