{%  extends 'layout.twig' %}

{% block content %}

<div class="container" style="margin-top:-30px;">

    <div class="row mb-3">

        <div class="col-sm-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="px-3">
                            <img src="{{ avatar(post.user_id, post.avatar) }}"
                                style="width:76px" class="rounded-circle mt-1">
                        </div>
                        <div class="flex-fill w-100">
                            <h4 class="mb-0">{{ post.title }}</h4>
                            <p class="mb-0 small text-muted">
                                {{ icon("info-circle", 18, 18) }} {{ post.meta_description }}
                            </p>
                        </div>
                        <div class="flex-fill text-right" style="min-width:300px;">
                            <a href="{{ url('blog') }}" class="btn btn-default">Blog Home</a>
                            
                            <a href="{{ url('blog/edit/'~post.id) }}" 
                                class="btn btn-default {{ can_edit ? "" : "disabled" }}">
                                Edit Post
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-9 col-lg-9">
            <div class="card border-0 shadow-sm mb-2">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="pr-3">
                        </div>
                        <div class="flex-fill w-100">
                            <p class="small text-muted">
                            {{ post.username }} | {{ post.date_posted|date("m.d.y")}}
                            </p>
                            {{ post.content|raw }}
                            <div class="a2a_kit a2a_kit_size_32 a2a_default_style">
                            <a class="a2a_dd" href="Https://runead.com/"></a>
                            <a class="a2a_button_facebook"></a>
                            <a class="a2a_button_twitter"></a>
                            <a class="a2a_button_reddit"></a>
                            <a class="a2a_button_digg"></a>
                            <a class="a2a_button_blogger"></a>
                            <a class="a2a_button_copy_link"></a>
                            </div>


                            



                        </div>
                    </div>
                </div>

                <div class="card-footer text-right">
                    <a href="{{ url('blog/delete/'~post.id) }}" class="btn btn-danger {{ can_edit ? "" : "disabled" }}">
                        Delete Post
                    </a>
                </div>
            </div>
        </div>

        <div class="col-sm-3 col-lg-3">
            <div class="card border-0 shadow-sm mb-2">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="pr-3">
                        </div>
                        <div class="flex-fill w-100">
                            <p class="small text-center text-default">
                                Comments
                            </p>

                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

    {{ content|raw }}
</div>



<script>
    document.addEventListener('DOMContentLoaded', function(event) {
        var apiUrl = 'https://api.imgur.com/3/image';
        var apiKey = '{{ constant("imgur_key") }}';
        var quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: '#toolbar'
            },
            placeholder: 'Comment...'
        });
        let alert = $('.alert-box');
        quill.getModule("toolbar").addHandler("image", function (a) {
            var input = document.createElement('input');
            input.setAttribute('type', 'file');
            input.click();
            input.onchange = (s) => {
                var file = input.files[0];
                if (/^image\//.test(file.type)) {
                    var settings = {
                        async: true,
                        crossDomain: true,
                        processData: false,
                        contentType: false,
                        type: 'POST',
                        url: apiUrl,
                        headers: {
                            Authorization: 'Client-ID ' + apiKey,
                            Accept: 'application/json'
                        },
                        mimeType: 'multipart/form-data'
                    };
                    var formData = new FormData();
                    formData.append("image", file);
                    settings.data = formData;
                    quill.enable(false);
                    var range = quill.getSelection();
                    if (range) {
                        $.ajax(settings).done(function(response) {
                            var json = JSON.parse(response);
                            var index = range.index;
                            quill.insertEmbed(index, 'image', json.data.link);
                            quill.enable();
                        });
                    } else {
                        alert("Please select a spot in your post where you wish the image to be placed.")
                    }
                } else {
                    console.warn('You can only upload images.');
                }
            }
        });

        $("#postform").on("submit", function (event) {
            var body = $(this).find(".ql-editor").html();
            $(this).find("#editor-form").html(body);
            return true;
        });
    });
    </script>



{%  endblock %}