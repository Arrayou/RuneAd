{%  extends 'layout.twig' %}

{% block content %}

<div class="container" style="margin-top:-30px;">

    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong>Newest Update!</strong> RuneAd now has a Videos page! Come check out some RSPS videos <a href="{{ url('videos/') }}">
            Here
        </a>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>



    <div class="row">
        <div class="col-sm-12">
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-body">
                    <div id="factBox" class="d-flex align-items-center"style="height:50px;">
                        <div class="w-100">
                            <p class="small text-muted mb-0">Did you know? Fact #<span id="factNum"></span></p>
                            <p id="factTxt" class="mb-0"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <!-- <div class="text-center card-body py-2 d-none d-lg-block">
                <div class="container">
                  <table class="table mt-0 mb-0 tab " style="line-height: 0.0em">
                    <a rel="sponsored"
                        target="_blank"
                        href="https://www.youtube.com/RuneScapeOriginal"
                        title="RuneAd Banner">
                        <video width="728" height="90" autoplay muted loop>
                        <source src="{{ url('public/img/banners/RSOG.mp4')}}" type="video/mp4">
                        </video>
                    </a>
                </table>
            </div>
        </div> -->

        <div class="row">
            <div class="col-lg-8 col-md-12 col-sm-12">
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-body text-center">
                    <p class="small text-muted mb-0">Vote for</p>
                    <h2 class="mb-4">{{ server.title }}</h2>

                    <div class="mb-5">
                    {% if server.banner_url %}
                        <a href="{{ url('details/'~server_url) }}" class="banner-img mx-auto">
                            <img data-src="{{ banner(server.banner_url) }}"
                                id="banner"
                                style="margin-top:14px;"
                                class="img-fluid rounded lazy">
                        </a>
                        {% else %}
                        <a href="{{ url('details/'~server_url) }}" class="banner-img mx-auto">
                            <img data-src="{{ url('public/img/banner-loading.png') }}"
                                id="banner"
                                style="margin-top:14px;"
                                class="img-fluid rounded lazy">
                        </a>
                    {% endif %}
                    </div>
                    <p id="status" class="{{ vote is null ? '' : 'text-danger' }}">
                        {% if vote is not null %}
                        You've already voted for this server. Your last vote was {{ elapsed(vote.voted_on) }}
                        {% else %}
                        &nbsp;
                        {% endif %}
                    </p>

                    {% set disabled = vote is null ? '' : 'disabled' %}
                    <div class="mb-4">
                        <a href="" class="btn btn-lg btn-primary vote" data-id="{{ server.id }}">
                            Vote Now
                        </a>

                        <a href="{{ url('details/'~server_url) }}" class="btn btn-lg btn-outline-primary">
                            View Server
                        </a>
                    </div>

                    <p class="text-muted small">You can vote once per 12 hours, per server</p>
                    <p>Have an issue with this server?
                        <a href="{{ url('report/'~server_url) }}">
                            File a report
                        </a>
                    </p>
                </div>
            </div>

            {{ content|raw }}

           <!-- <div class="text-center card-body py-2 d-none d-lg-block">
                <div class="container">
                  <table class="table mt-0 mb-0 tab " style="line-height: 0.0em">
                    <a rel="sponsored"
                        target="_blank"
                        href="https://www.youtube.com/RuneScapeOriginal"
                        title="RuneAd Banner">
                        <video width="728" height="90" autoplay muted loop>
                        <source src="{{ url('public/img/banners/RSOG.mp4')}}" type="video/mp4">
                        </video>
                    </a>
                </table>
            </div>
        </div> -->

        </div>




        <div class="col-lg-4 col-md-12 col-sm-12">


            <div class="card shadow-sm border-success mb-3">
                <div class="card border-success shadow text-primary p-3 my-card">
                    <span class="fa fa-signal" aria-hidden="true">Status</span>
                </div>
                    <div class="text-info text-center mt-1">
                        <h4 class="mb-0 text-{{ server.is_online ? 'success' : 'danger' }}">
                        {{ server.is_online ? 'Online' : 'Offline' }}
                        </h4>    
                    </div>
                </div>

            <div class="card shadow-sm border-0 mb-3">
                <div class="card-body">
                    <small class="text-muted">
                        Owner
                    </small>
                    <h6 class="mb-0">
                        <a href="https://discord.com/users/{{ server.user_id }}" target="_blank">{{ server.username }}#{{ server.discriminator }}</a>
                    </h6>
                </div>
            </div>

            <div class="card shadow-sm border-info mb-3">
            <div class="card border-info shadow text-info p-3 my-card">
                <span class="fa fa-vote-yea" aria-hidden="true">Votes</span>
            </div>
                <div class="text-info text-center mt-1"><h3>{{ server.votes }}</h3></div>
            </div>

            <div class="card shadow-sm border-0 mb-3">
                <div class="card-body">
                    <small class="text-muted">Links</small>
                    <h6 class="mb-0">
                        
                        
                        {% if server.discord_link and server.discord_link != "" %}
                        <a href="{{ server.discord_link }}" class="btn btn-primary btn-sm py-1 text-uppercase mr-0"
                            style="font-size:9px;"
                            target="_blank">
                            {{ icon('discord') }} DISCORD
                        </a>
                        {% endif %}
                        
                        {% if server.website and server.website != "" %}
                        <a href="{{ server.website }}" class="btn btn-primary btn-sm py-1 text-uppercase"
                            style="font-size:9px;"
                            rel="sponsored" target="_blank">
                            {{ icon('link-45deg') }} WEBSITE
                        </a>
                        {% endif %}

                    </h6>
                </div>
            </div>
        </div>













        
    </div>
</div>
{% set recaptcha_key = constant('recaptcha')['public'] %}
<script src="https://www.google.com/recaptcha/api.js?render={{ recaptcha_key }}" defer async></script>
<script defer type="text/javascript" src="{{ url('public/js/rsfacts.js')}}"></script>

<script>
document.addEventListener('DOMContentLoaded', function( event) {
    $('.vote').click(function(event) {
        event.preventDefault();

        let btn = $(this);
        let txt = $(this).text();
        let id  = $(this).data("id");
        let status = $('#status');
        btn.html('{{ icon("three-dots", 18, 18) }}');
        btn.addClass("disabled");
        btn.removeClass("btn-success btn-danger").addClass("btn-primary");
        status.html("&nbsp;").removeClass("text-danger text-success");
        grecaptcha.ready(function() {
            grecaptcha.execute("{{ recaptcha_key }}", {
                action: 'homepage'
            }).then(function(token) {
                $.ajaxq('VoteQueue', {
                    url: '{{ url("servers/addvote") }}',
                    data: {
                        server_id: id,
                        token: token,
                        incentive: '{{ incentive }}'
                    },
                    type: 'POST',
                    complete: function (data) {

                    },
                    success: function (json) {
                        console.log(json);

                        $('#status').removeClass("text-danger text-success")
                            .addClass(json.success ? "text-success" : "text-danger")
                            .html(json.message);
                        btn.removeClass("btn-primary btn-danger btn-success")
                            .addClass("btn-"+(json.success ? 'success' : 'danger'));

                        btn.html(json.success ? '{{ icon("check", 18, 18) }}' : '{{ icon("x", 18, 18) }}');

                        setTimeout(function() {
                            btn.removeClass("btn-success btn-danger disabled")
                                .addClass("btn-primary");
                            btn.html("Vote Now");
                        }, 700);
                    },
                    error: function(data) {
                        console.log(data.responseText);
                    }
                });
            });
        });
    });
});
</script>

{%  endblock %}
